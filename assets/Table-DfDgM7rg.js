var st=Object.defineProperty,lt=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var $e=Object.getOwnPropertySymbols;var ct=Object.prototype.hasOwnProperty,ut=Object.prototype.propertyIsEnumerable;var Te=(e,t,n)=>t in e?st(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,O=(e,t)=>{for(var n in t||(t={}))ct.call(t,n)&&Te(e,n,t[n]);if($e)for(var n of $e(t))ut.call(t,n)&&Te(e,n,t[n]);return e},K=(e,t)=>lt(e,rt(t));var H=(e,t,n)=>new Promise((o,a)=>{var u=i=>{try{r(n.next(i))}catch(g){a(g)}},f=i=>{try{r(n.throw(i))}catch(g){a(g)}},r=i=>i.done?o(i.value):Promise.resolve(i.value).then(u,f);r((n=n.apply(e,t)).next())});import{aU as Re,aV as dt,aW as ft,aX as gt,aY as mt,aZ as pt,a_ as ht,a$ as vt,b0 as _t,b1 as Ae,b2 as Ct,b3 as bt,b4 as kt,b5 as wt,b6 as St,b7 as yt,b8 as Nt,b9 as Ot,ba as Be,bb as He,d as Q,o as x,c as q,a as T,bc as Dt,bd as $t,ab as Tt,r as P,b as Ue,M as L,a5 as ge,aq as Me,be as ae,aB as ie,h as l,q as ye,as as B,E as Ne,w as k,i as _,k as ee,aM as Fe,N as pe,n as qe,B as Rt,H as Ft,aH as Oe,Z as We,aI as zt,bf as Ke,W as he,l as Lt,bg as Pt,am as Et,bh as Ye,al as Vt,bi as It,A as Y,bj as xt,aD as J,U as Ze,ar as we,aT as A,a6 as ce,bk as ze,aA as te,ak as At,aj as Bt,S as je,at as me,t as Se,aS as Ht,a1 as Ge,bl as Qe,V as be,Q as Ut,v as Mt,aF as qt,aG as Wt,F as Kt,aP as Yt,p as Zt,j as jt}from"./index-DF_kSXQG.js";import{D as Gt}from"./vuedraggable.umd-BX7EVXTZ.js";import{u as Qt}from"./useDesignSetting-cNzLB8o_.js";import{p as de,s as Xt,Q as Jt}from"./propTypes-SluNXMpz.js";import{F as Xe}from"./FormOutlined-1JxOwo8C.js";import{C as en,a as tn,R as nn}from"./ReloadOutlined-D1R8l4LN.js";import{c as on}from"./componentSetting-CQq0JJwW.js";import{f as an,t as sn,g as ln}from"./index-D0LruBwq.js";var Le=Re?Re.isConcatSpreadable:void 0;function rn(e){return dt(e)||ft(e)||!!(Le&&e&&e[Le])}function cn(e,t,n,o,a){var u=-1,f=e.length;for(n||(n=rn),a||(a=[]);++u<f;){var r=e[u];n(r)?gt(a,r):a[a.length]=r}return a}function un(e){var t=e==null?0:e.length;return t?cn(e):[]}function dn(e){return mt(pt(e,void 0,un),e+"")}function fn(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function gn(e,t){return t.length<2?e:ht(e,vt(t,0,-1))}function mn(e,t){return _t(e,t)}function pn(e,t){return t=Ae(t,e),e=gn(e,t),e==null||delete e[Ct(fn(t))]}function hn(e){return bt(e)?void 0:e}var vn=1,_n=2,Cn=4,bn=dn(function(e,t){var n={};if(e==null)return n;var o=!1;t=kt(t,function(u){return u=Ae(u,e),o||(o=u.length>1),u}),wt(e,St(e),n),o&&(n=yt(n,vn|_n|Cn,hn));for(var a=t.length;a--;)pn(n,t[a]);return n});function Pe(e,t){var n;Nt(1,arguments);var o=Ot((n=void 0)!==null&&n!==void 0?n:2);if(o!==2&&o!==1&&o!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var a=yn(e),u;if(a.date){var f=Nn(a.date,o);u=On(f.restDateString,f.year)}if(!u||isNaN(u.getTime()))return new Date(NaN);var r=u.getTime(),i=0,g;if(a.time&&(i=Dn(a.time),isNaN(i)))return new Date(NaN);if(a.timezone){if(g=$n(a.timezone),isNaN(g))return new Date(NaN)}else{var S=new Date(r+i),D=new Date(0);return D.setFullYear(S.getUTCFullYear(),S.getUTCMonth(),S.getUTCDate()),D.setHours(S.getUTCHours(),S.getUTCMinutes(),S.getUTCSeconds(),S.getUTCMilliseconds()),D}return new Date(r+i+g)}var ue={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},kn=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,wn=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Sn=/^([+-])(\d{2})(?::?(\d{2}))?$/;function yn(e){var t={},n=e.split(ue.dateTimeDelimiter),o;if(n.length>2)return t;if(/:/.test(n[0])?o=n[0]:(t.date=n[0],o=n[1],ue.timeZoneDelimiter.test(t.date)&&(t.date=e.split(ue.timeZoneDelimiter)[0],o=e.substr(t.date.length,e.length))),o){var a=ue.timezone.exec(o);a?(t.time=o.replace(a[1],""),t.timezone=a[1]):t.time=o}return t}function Nn(e,t){var n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),o=e.match(n);if(!o)return{year:NaN,restDateString:""};var a=o[1]?parseInt(o[1]):null,u=o[2]?parseInt(o[2]):null;return{year:u===null?a:u*100,restDateString:e.slice((o[1]||o[2]).length)}}function On(e,t){if(t===null)return new Date(NaN);var n=e.match(kn);if(!n)return new Date(NaN);var o=!!n[4],a=ne(n[1]),u=ne(n[2])-1,f=ne(n[3]),r=ne(n[4]),i=ne(n[5])-1;if(o)return Ln(t,r,i)?Tn(t,r,i):new Date(NaN);var g=new Date(0);return!Fn(t,u,f)||!zn(t,a)?new Date(NaN):(g.setUTCFullYear(t,u,Math.max(a,f)),g)}function ne(e){return e?parseInt(e):1}function Dn(e){var t=e.match(wn);if(!t)return NaN;var n=ke(t[1]),o=ke(t[2]),a=ke(t[3]);return Pn(n,o,a)?n*Be+o*He+a*1e3:NaN}function ke(e){return e&&parseFloat(e.replace(",","."))||0}function $n(e){if(e==="Z")return 0;var t=e.match(Sn);if(!t)return 0;var n=t[1]==="+"?-1:1,o=parseInt(t[2]),a=t[3]&&parseInt(t[3])||0;return En(o,a)?n*(o*Be+a*He):NaN}function Tn(e,t,n){var o=new Date(0);o.setUTCFullYear(e,0,4);var a=o.getUTCDay()||7,u=(t-1)*7+n+1-a;return o.setUTCDate(o.getUTCDate()+u),o}var Rn=[31,null,31,30,31,30,31,31,30,31,30,31];function Je(e){return e%400===0||e%4===0&&e%100!==0}function Fn(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(Rn[t]||(Je(e)?29:28))}function zn(e,t){return t>=1&&t<=(Je(e)?366:365)}function Ln(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function Pn(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function En(e,t){return t>=0&&t<=59}const Vn={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},In=T("path",{d:"M840 836H184c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h656c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm0-724H184c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h656c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM610.8 378c6 0 9.4-7 5.7-11.7L515.7 238.7a7.14 7.14 0 0 0-11.3 0L403.6 366.3a7.23 7.23 0 0 0 5.7 11.7H476v268h-62.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V378h62.8z",fill:"currentColor"},null,-1),xn=[In],An=Q({name:"ColumnHeightOutlined",render:function(t,n){return x(),q("svg",Vn,xn)}}),Bn={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Hn=T("path",{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 0 0-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 0 0-11.3 0L405.6 242.3a7.23 7.23 0 0 0 5.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 0 0 0 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 0 0 .1-11.4z",fill:"currentColor"},null,-1),Un=[Hn],Mn=Q({name:"DragOutlined",render:function(t,n){return x(),q("svg",Bn,Un)}}),qn={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Wn=T("path",{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512L265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512L267.1 157.9A7.95 7.95 0 0 0 254 164z",fill:"currentColor"},null,-1),Kn=[Wn],Yn=Q({name:"VerticalLeftOutlined",render:function(t,n){return x(),q("svg",qn,Kn)}}),Zn={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},jn=T("path",{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z",fill:"currentColor"},null,-1),Gn=[jn],Qn=Q({name:"VerticalRightOutlined",render:function(t,n){return x(),q("svg",Zn,Gn)}}),et=Symbol("s-table");function Xn(e){$t(et,e)}function tt(){return Dt(et)}const Jn=Q({name:"ColumnSetting",components:{SettingOutlined:Tt,DragOutlined:Mn,Draggable:Gt,VerticalRightOutlined:Qn,VerticalLeftOutlined:Yn},setup(){const{getDarkTheme:e}=Qt(),t=tt(),n=P([]),o=P([]),a=Ue({selection:!1,checkAll:!0,checkList:[],defaultCheckList:[]}),u=L(()=>a.selection);ge(()=>{t.getColumns().length&&f()});function f(){const d=g(),p=d.map(C=>C.key);a.checkList=p,a.defaultCheckList=p;const w=d.filter(C=>C.key!="action"&&C.title!="操作");n.value.length||(n.value=ae(w),o.value=ae(w))}function r(d){a.selection&&d.unshift("selection"),i(d)}function i(d){t.setColumns(d)}function g(){let d=[];return t.getColumns().forEach(p=>{d.push(O({},p))}),d}function S(){a.checkList=[...a.defaultCheckList],a.checkAll=!0;let p=t.getCacheColumns().map(w=>K(O({},w),{fixed:void 0}));i(p),n.value=p}function D(d){let p=t.getCacheColumns(!0);d?(i(p),a.checkList=p):(i([]),a.checkList=[])}function F(){const d=ie(l(n));n.value=d,i(d)}function c(d){let p=t.getCacheColumns();d?(p.unshift({type:"selection",key:"selection"}),i(p)):(p.splice(0,1),i(p))}function m(d){return d.draggedContext.element.draggable!==!1}function h(d,p){if(!a.checkList.includes(d.key))return;let w=g();const C=d.fixed===p?void 0:p;let I=w.findIndex(U=>U.key===d.key);I!==-1&&(w[I].fixed=C),t.setCacheColumnsField(d.key,{fixed:C}),n.value[I].fixed=C,i(w)}return K(O({},Me(a)),{columnsList:n,getDarkTheme:e,onChange:r,onCheckAll:D,onSelection:c,onMove:m,resetColumns:S,fixedColumn:h,draggableEnd:F,getSelection:u})}}),eo={class:"cursor-pointer table-toolbar-right-icon"},to={class:"table-toolbar-inner-popover-title"},no={class:"table-toolbar-inner"},oo={class:"fixed-item"},ao=T("span",null,"固定到左侧",-1),io=T("span",null,"固定到右侧",-1),so=T("span",null,"列设置",-1);function lo(e,t,n,o,a,u){const f=B("SettingOutlined"),r=pe,i=qe,g=Rt,S=Ft,D=B("DragOutlined"),F=B("VerticalRightOutlined"),c=Oe,m=We,h=B("VerticalLeftOutlined"),d=B("Draggable"),p=zt,w=Ke;return x(),Ne(c,{trigger:"hover"},{trigger:k(()=>[T("div",eo,[_(w,{trigger:"click",width:230,class:"toolbar-popover",placement:"bottom-end"},{trigger:k(()=>[_(r,{size:"18"},{default:k(()=>[_(f)]),_:1})]),header:k(()=>[T("div",to,[_(S,null,{default:k(()=>[_(i,{checked:e.checkAll,"onUpdate:checked":[t[0]||(t[0]=C=>e.checkAll=C),e.onCheckAll]},{default:k(()=>[ee("列展示")]),_:1},8,["checked","onUpdate:checked"]),_(i,{checked:e.selection,"onUpdate:checked":[t[1]||(t[1]=C=>e.selection=C),e.onSelection]},{default:k(()=>[ee("勾选列")]),_:1},8,["checked","onUpdate:checked"]),_(g,{text:"",type:"info",size:"small",class:"mt-1",onClick:e.resetColumns},{default:k(()=>[ee("重置")]),_:1},8,["onClick"])]),_:1})])]),default:k(()=>[T("div",no,[_(p,{value:e.checkList,"onUpdate:value":[t[3]||(t[3]=C=>e.checkList=C),e.onChange]},{default:k(()=>[_(d,{modelValue:e.columnsList,"onUpdate:modelValue":t[2]||(t[2]=C=>e.columnsList=C),animation:"300","item-key":"key",filter:".no-draggable",move:e.onMove,onEnd:e.draggableEnd},{item:k(({element:C})=>[T("div",{class:Fe(["table-toolbar-inner-checkbox",{"table-toolbar-inner-checkbox-dark":e.getDarkTheme===!0,"no-draggable":C.draggable===!1}])},[T("span",{class:Fe(["drag-icon",{"drag-icon-hidden":C.draggable===!1}])},[_(r,{size:"18"},{default:k(()=>[_(D)]),_:1})],2),_(i,{value:C.key,label:C.title},null,8,["value","label"]),T("div",oo,[_(c,{trigger:"hover",placement:"bottom"},{trigger:k(()=>[_(r,{size:"18",color:C.fixed==="left"?"#2080f0":void 0,class:"cursor-pointer",onClick:I=>e.fixedColumn(C,"left")},{default:k(()=>[_(F)]),_:2},1032,["color","onClick"])]),default:k(()=>[ao]),_:2},1024),_(m,{vertical:""}),_(c,{trigger:"hover",placement:"bottom"},{trigger:k(()=>[_(r,{size:"18",color:C.fixed==="right"?"#2080f0":void 0,class:"cursor-pointer",onClick:I=>e.fixedColumn(C,"right")},{default:k(()=>[_(h)]),_:2},1032,["color","onClick"])]),default:k(()=>[io]),_:2},1024)])],2)]),_:1},8,["modelValue","move","onEnd"])]),_:1},8,["value","onUpdate:value"])])]),_:1})])]),default:k(()=>[so]),_:1})}const nt=ye(Jn,[["render",lo]]);function ro(e){const t=P(l(e).loading);he(()=>l(e).loading,a=>{t.value=a});const n=L(()=>l(t));function o(a){t.value=a}return{getLoading:n,setLoading:o}}var ot=(e=>(e.NInput="on-input",e.NInputNumber="on-input",e.NSelect="on-update:value",e.NSwitch="on-update:value",e.NCheckbox="on-update:value",e.NDatePicker="on-update:value",e.NTimePicker="on-update:value",e))(ot||{});const j=new Map;j.set("NInput",Lt);j.set("NInputNumber",Pt);j.set("NSelect",Et);j.set("NSwitch",Ye);j.set("NCheckbox",qe);j.set("NDatePicker",Vt);j.set("NTimePicker",It);const co=({component:e="NInput",rule:t=!0,ruleMessage:n,popoverVisible:o},{attrs:a})=>{const u=j.get(e),f=Y(u,a);return t?Y(Ke,{"display-directive":"show",show:!!o,manual:"manual"},{trigger:()=>f,default:()=>Y("span",{style:{color:"red",width:"90px",display:"inline-block"}},{default:()=>n})}):f};function uo(e){return!e||!e.getBoundingClientRect?0:e.getBoundingClientRect()}function fo(e){const t=document.documentElement,n=t.scrollLeft,o=t.scrollTop,a=t.clientLeft,u=t.clientTop,f=window.pageXOffset,r=window.pageYOffset,i=uo(e),{left:g,top:S,width:D,height:F}=i,c=(f||n)-(a||0),m=(r||o)-(u||0),h=g+f,d=S+r,p=h-c,w=d-m,C=window.document.documentElement.clientWidth,I=window.document.documentElement.clientHeight;return{left:p,top:w,right:C-D-p,bottom:I-F-w,rightIncludeBody:C-p,bottomIncludeBody:I-w}}function Ee(e,t,n){e&&t&&n&&e.addEventListener(t,n,!1)}const fe=new Map;let Ve;xt||(Ee(document,"mousedown",e=>Ve=e),Ee(document,"mouseup",e=>{for(const{documentHandler:t}of fe.values())t(e,Ve)}));function Ie(e,t){let n=[];return Array.isArray(t.arg)?n=t.arg:n.push(t.arg),function(o,a){const u=t.instance.popperRef,f=o.target,r=a.target,i=!t||!t.instance,g=!f||!r,S=e.contains(f)||e.contains(r),D=e===f,F=n.length&&n.some(m=>m==null?void 0:m.contains(f))||n.length&&n.includes(r),c=u&&(u.contains(f)||u.contains(r));i||g||S||D||F||c||t.value()}}const go={beforeMount(e,t){fe.set(e,{documentHandler:Ie(e,t),bindingFn:t.value})},updated(e,t){fe.set(e,{documentHandler:Ie(e,t),bindingFn:t.value})},unmounted(e){fe.delete(e)}};function xe(e){return e==="NInput"?"请输入":["NPicker","NSelect","NCheckbox","NRadio","NSwitch","NDatePicker","NTimePicker"].includes(e)?"请选择":""}const mo=Q({name:"EditableCell",components:{FormOutlined:Xe,CloseOutlined:en,CheckOutlined:tn,CellComponent:co},directives:{clickOutside:go},props:{value:{type:[String,Number,Boolean,Object],default:""},record:{type:Object},column:{type:Object,default:()=>({})},index:de.number},setup(e){const t=tt(),n=P(!1),o=P(),a=P(!1),u=P(""),f=P([]),r=P(e.value),i=P(e.value),g=L(()=>{var s;return((s=e.column)==null?void 0:s.editComponent)||"NInput"}),S=L(()=>{var s;return(s=e.column)==null?void 0:s.editRule}),D=L(()=>l(u)&&l(a)),F=L(()=>{const s=l(g);return["NCheckbox","NRadio"].includes(s)}),c=L(()=>{var N,W,se,le;const s=(W=(N=e.column)==null?void 0:N.editComponentProps)!=null?W:{},v=(le=(se=e.column)==null?void 0:se.editComponent)!=null?le:null,b=l(g),R={},y=l(F);let E=y?"checked":"value";const $=l(r);let z=y?ce($)&&A($)?$:!!$:$;b==="NDatePicker"&&(we(z)?s.valueFormat?E="formatted-value":z=Pe(z).getTime():J(z)&&(s.valueFormat?E="formatted-value":z=z.map(ve=>Pe(ve).getTime())));const V=v?ot[v]:void 0;return K(O(O({placeholder:xe(l(g))},R),bn(s,"onChange")),{[V]:w,[E]:z})}),m=L(()=>{var $,z;const{editComponentProps:s,editValueMap:v}=e.column,b=l(r);if(v&&te(v))return v(b);if(!l(g).includes("NSelect"))return b;const E=(($=s==null?void 0:s.options)!=null?$:l(f)||[]).find(V=>`${V.value}`==`${b}`);return(z=E==null?void 0:E.label)!=null?z:b}),h=L(()=>{const{align:s="center"}=e.column;return`edit-cell-align-${s}`}),d=L(()=>{const{editable:s}=e.record||{};return!!s});ge(()=>{i.value=e.value}),ge(()=>{const{editable:s}=e.column;(A(s)||A(l(d)))&&(n.value=!!s||l(d))});function p(){var s;l(d)||l((s=e.column)==null?void 0:s.editRow)||(u.value="",n.value=!0,Ze(()=>{var b;const v=l(o);(b=v==null?void 0:v.focus)==null||b.call(v)}))}function w(v){return H(this,arguments,function*(s){var E,$,z,V,N;const b=l(g),R=($=(E=e.column)==null?void 0:E.editComponentProps)!=null?$:{};s?s!=null&&s.target&&Reflect.has(s.target,"value")?r.value=s.target.value:b==="NCheckbox"?r.value=s.target.checked:(we(s)||A(s)||ce(s))&&(r.value=s):r.value=s,b==="NDatePicker"&&(ce(r.value)?R.valueFormat&&(r.value=ze(r.value,R.valueFormat)):J(r.value)&&R.valueFormat&&(r.value=r.value.map(W=>{ze(W,R.valueFormat)})));const y=(V=(z=e.column)==null?void 0:z.editComponentProps)==null?void 0:V.onChange;y&&te(y)&&y(...arguments),(N=t.emit)==null||N.call(t,"edit-change",{column:e.column,value:l(r),record:ie(e.record)}),yield C()})}function C(){return H(this,null,function*(){const{column:s,record:v}=e,{editRule:b}=s,R=l(r);if(b){if(A(b)&&!R&&!ce(R)){a.value=!0;const y=l(g);return u.value=xe(y),!1}if(te(b)){const y=yield b(R,v);return y?(u.value=y,a.value=!0,!1):(u.value="",!0)}}return u.value="",!0})}function I(s=!0,v=!0){return H(this,null,function*(){var V;if(v&&!(yield C()))return!1;const{column:b,index:R,record:y}=e;if(!y)return!1;const{key:E}=b,$=l(r);if(!E)return;Xt(y,E,$),s&&((V=t.emit)==null||V.call(t,"edit-end",{record:y,index:R,key:E,value:$})),n.value=!1})}function U(){return H(this,null,function*(){var s;(s=e.column)!=null&&s.editRow||(yield I())})}function G(){var y;n.value=!1,r.value=i.value;const{column:s,index:v,record:b}=e,{key:R}=s;a.value=!0,u.value="",(y=t.emit)==null||y.call(t,"edit-cancel",{record:b,index:v,key:R,value:l(r)})}function M(){var v;if((v=e.column)!=null&&v.editable||l(d))return;l(g).includes("NInput")&&G()}function X(s){f.value=s}function Z(s,v){var b;e.record&&(J(e.record[s])?(b=e.record[s])==null||b.push(v):e.record[s]=[v])}return e.record&&(Z("submitCbs",I),Z("validCbs",C),Z("cancelCbs",G),e.column.key&&(e.record.editValueRefs||(e.record.editValueRefs={}),e.record.editValueRefs[e.column.key]=r),e.record.onCancelEdit=()=>{var s,v;J((s=e.record)==null?void 0:s.cancelCbs)&&((v=e.record)==null||v.cancelCbs.forEach(b=>b()))},e.record.onSubmitEdit=()=>H(this,null,function*(){var s,v,b,R;if(J((s=e.record)==null?void 0:s.submitCbs)){const y=(((v=e.record)==null?void 0:v.validCbs)||[]).map(V=>V());return(yield Promise.all(y)).every(V=>!!V)?((((b=e.record)==null?void 0:b.submitCbs)||[]).forEach(V=>V(!1,!1)),(R=t.emit)==null||R.call(t,"edit-row-end"),!0):void 0}})),{isEdit:n,handleEdit:p,currentValueRef:r,handleSubmit:I,handleChange:w,handleCancel:G,elRef:o,getComponent:g,getRule:S,onClickOutside:M,ruleMessage:u,getRuleVisible:D,getComponentProps:c,handleOptionsChange:X,getWrapperClass:h,getRowEditable:d,getValues:m,handleEnter:U}}}),po={class:"editable-cell"},ho={key:0,class:"flex editable-cell-content"},vo={class:"editable-cell-content-comp"},_o={key:0,class:"editable-cell-action"};function Co(e,t,n,o,a,u){const f=B("CellComponent"),r=B("CheckOutlined"),i=pe,g=B("CloseOutlined"),S=B("FormOutlined"),D=At("click-outside");return x(),q("div",po,[e.isEdit?Bt((x(),q("div",ho,[T("div",vo,[_(f,je(e.getComponentProps,{component:e.getComponent,popoverVisible:e.getRuleVisible,ruleMessage:e.ruleMessage,rule:e.getRule,class:e.getWrapperClass,ref:"elRef",onOptionsChange:e.handleOptionsChange,onPressEnter:e.handleEnter}),null,16,["component","popoverVisible","ruleMessage","rule","class","onOptionsChange","onPressEnter"])]),e.getRowEditable?me("",!0):(x(),q("div",_o,[_(i,{class:"mx-2 cursor-pointer"},{default:k(()=>[_(r,{onClick:e.handleSubmit},null,8,["onClick"])]),_:1}),_(i,{class:"mx-2 cursor-pointer"},{default:k(()=>[_(g,{onClick:e.handleCancel},null,8,["onClick"])]),_:1})]))])),[[D,e.onClickOutside]]):(x(),q("div",{key:1,class:"flex items-center editable-cell-content",onClick:t[0]||(t[0]=(...F)=>e.handleEdit&&e.handleEdit(...F))},[ee(Se(e.getValues)+" ",1),e.column.editRow?me("",!0):(x(),Ne(i,{key:0,class:"ml-1 edit-icon"},{default:k(()=>[_(S)]),_:1}))]))])}const bo=ye(mo,[["render",Co]]);function ko(e){return(t,n)=>{const o=e.key,a=t[o];return t.onEdit=(u,f=!1)=>H(this,null,function*(){var r,i;return f||(t.editable=u),!u&&f?(yield(r=t.onSubmitEdit)==null?void 0:r.call(t))?(t.editable=!1,!0):!1:(!u&&!f&&((i=t.onCancelEdit)==null||i.call(t)),!0)}),Y(bo,{value:a,record:t,column:e,index:n})}}function wo(e){const t=P(l(e).columns);let n=l(e).columns;const o=L(()=>{const c=ae(l(t));return i(e,c),c||[]}),{hasPermission:a}=Ht();function u(c){const m=c.ifShow;let h=!0;return A(m)&&(h=m),te(m)&&(h=m(c)),h}const f=(c,m)=>Y(Oe,null,{trigger:()=>c,default:()=>m}),r=L(()=>{const c=l(o);return ae(c).filter(h=>a(h.auth)&&u(h)).map(h=>{h.ellipsis=typeof h.ellipsis=="undefined"?{tooltip:!0}:!1;const{edit:d}=h;if(d&&(h.render=ko(h),d)){const p=h.title;h.title=()=>f(Y("span",{},[Y("span",{style:{"margin-right":"5px"}},p),Y(pe,{size:14},{default:()=>Y(Xe)})]),"该列可编辑")}return h})});he(()=>l(e).columns,c=>{t.value=c,n=c});function i(c,m){const{actionColumn:h}=l(c);h&&!m.find(d=>d.key==="action")&&m.push(O({},h))}function g(c){const m=ae(c);if(!J(m))return;if(!m.length){t.value=[];return}const h=n.map(d=>d.key);if(!we(m[0]))t.value=m;else{const d=[];n.forEach(p=>{c.includes(p.key)&&d.push(O({},p))}),mn(h,m)||d.sort((p,w)=>h.indexOf(p.key)-h.indexOf(w.key)),t.value=d}}function S(){return ie(l(o)).map(m=>K(O({},m),{title:m.title,key:m.key,fixed:m.fixed||void 0}))}function D(c){return c?n.map(m=>m.key):n}function F(c,m){!c||!m||n.forEach(h=>{if(h.key===c){Object.assign(h,m);return}})}return{getColumnsRef:o,getCacheColumns:D,setCacheColumnsField:F,setColumns:g,getColumns:S,getPageColumns:r}}const{table:So}=on,{apiSetting:yo,defaultPageSize:No,pageSizes:Oo}=So,Do=No,oe=yo,$o=Oo;function To(e,{getPaginationInfo:t,setPagination:n,setLoading:o,tableData:a},u){const f=P([]);ge(()=>{a.value=l(f)}),he(()=>l(e).dataSource,()=>{const{dataSource:c}=l(e);c&&(f.value=c)},{immediate:!0});const r=L(()=>{const{rowKey:c}=l(e);return c||(()=>"key")}),i=L(()=>{const c=l(f);return!c||c.length===0?l(f):l(f)});function g(c){return H(this,null,function*(){try{o(!0);const{request:m,pagination:h,beforeRequest:d,afterRequest:p}=l(e);if(!m)return;const w=oe.pageField,C=oe.sizeField,I=oe.totalField,U=oe.listField,G=oe.countField;let M={};const{page:X=1,pageSize:Z=10}=l(t);A(h)&&!h||A(t)?M={}:(M[w]=c&&c[w]||X,M[C]=Z);let s=O(O({},M),c);d&&te(d)&&(s=(yield d(s))||s);const v=yield m(s),b=v[I],R=v[w],y=v[G],E=v[U]?v[U]:[];if(b){const z=Math.ceil(y/Z);if(X>z)return n({page:z,itemCount:y}),yield g(c)}let $=v[U]?v[U]:[];p&&te(p)&&($=(yield p($))||$),f.value=$,n({page:R,pageCount:b,itemCount:y}),c&&c[w]&&n({page:c[w]||1}),u("fetch-success",{items:l($),resultTotal:b})}catch(m){console.error(m),u("fetch-error",m),f.value=[],n({pageCount:0})}finally{o(!1)}})}Ge(()=>{setTimeout(()=>{g()},16)});function S(c){f.value=c}function D(){return i.value}function F(c){return H(this,null,function*(){yield g(c)})}return{fetch:g,getRowKey:r,getDataSourceRef:i,getDataSource:D,setTableData:S,reload:F}}function Ro(e){const t=P({}),n=P(!0);he(()=>l(e).pagination,i=>{!A(i)&&i&&(t.value=O(O({},l(t)),i!=null?i:{}))});const o=L(()=>{const{pagination:i}=l(e);return!l(n)||A(i)&&!i?!1:O(O({page:1,pageSize:Do,pageSizes:$o,showSizePicker:!0,showQuickJumper:!0,prefix:g=>`共 ${g.itemCount} 条`},A(i)?{}:i),l(t))});function a(i){const g=l(o);t.value=O(O({},A(g)?{}:g),i)}function u(){return l(o)}function f(){return l(n)}function r(i){return H(this,null,function*(){n.value=i})}return{getPagination:u,getPaginationInfo:o,setShowPagination:r,getShowPagination:f,setPagination:a}}const Fo=K(O({},Qe.props),{title:{type:String,default:null},titleTooltip:{type:String,default:null},size:{type:String,default:"medium"},dataSource:{type:[Object],default:()=>[]},columns:{type:[Array],default:()=>[],required:!0},beforeRequest:{type:Function,default:null},request:{type:Function,default:null},afterRequest:{type:Function,default:null},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},showPagination:{type:[String,Boolean],default:"auto"},actionColumn:{type:Object,default:null},canResize:de.bool.def(!0),resizeHeightOffset:de.number.def(0),striped:de.bool.def(!1)});function zo(e,t=150,n){let o=()=>{e()};o=ln(o,t);const u=()=>{window.addEventListener("resize",o)},f=()=>{window.removeEventListener("resize",o)};return an(()=>{u()}),sn(()=>{f()}),[u,f]}const Lo=[{type:"menu",label:"紧凑",key:"small"},{type:"menu",label:"默认",key:"medium"},{type:"menu",label:"宽松",key:"large"}],Po=Q({components:{ReloadOutlined:nn,ColumnHeightOutlined:An,ColumnSetting:nt,QuestionCircleOutlined:Jt},props:O({},Fo),emits:["fetch-success","fetch-error","update:checked-row-keys","edit-end","edit-cancel","edit-row-end","edit-change"],setup(e,{emit:t}){const n=P(150),o=P(null),a=P(null);let u;const f=P(e.striped||!1),r=P([]),i=P(),g=L(()=>O(O({},e),l(i))),{getLoading:S,setLoading:D}=ro(g),{getPaginationInfo:F,setPagination:c}=Ro(g),{getDataSourceRef:m,getDataSource:h,getRowKey:d,reload:p}=To(g,{getPaginationInfo:F,setPagination:c,tableData:r,setLoading:D},t),{getPageColumns:w,setColumns:C,getColumns:I,getCacheColumns:U,setCacheColumnsField:G}=wo(g),M=Ue({tableSize:l(g).size||"medium",isColumnSetting:!1});function X(N){c({page:N}),p()}function Z(N){c({page:1,pageSize:N}),p()}function s(N){M.tableSize=N}const v=L(()=>M.tableSize),b=L(()=>{const N=l(m),W=N.length?`${l(n)}px`:"auto";return K(O({},l(g)),{loading:l(S),columns:ie(l(w)),rowKey:l(d),data:N,size:l(v),remote:!0,"max-height":W})}),R=L(()=>ie(l(F)));function y(N){i.value=O(O({},l(i)),N)}const E=N=>f.value=N,$={reload:p,setColumns:C,setLoading:D,setProps:y,getColumns:I,getPageColumns:w,getCacheColumns:U,setCacheColumnsField:G,emit:t},z=L(()=>{const{canResize:N}=l(g);return N});function V(){return H(this,null,function*(){const N=l(o);if(!N||!l(z))return;const W=N==null?void 0:N.$el,se=W.querySelector(".n-data-table-thead "),{bottomIncludeBody:le}=fo(se),ve=64;let _e=2,at=24;if(!A(l(R)))if(u=W.querySelector(".n-data-table__pagination"),u){const it=u.offsetHeight;_e+=it||0}else _e+=28;let re=le-(ve+_e+at+(e.resizeHeightOffset||0));const Ce=e.maxHeight;re=Ce&&Ce<re?Ce:re,n.value=re})}return zo(V,280),Ge(()=>{Ze(()=>{V()})}),Xn(K(O({},$),{wrapRef:a,getBindValues:b})),K(O({},Me(M)),{tableElRef:o,getBindValues:b,getDataSource:h,densityOptions:Lo,reload:p,densitySelect:s,updatePage:X,updatePageSize:Z,pagination:R,tableAction:$,setStriped:E,isStriped:f})}}),De=e=>(Zt("data-v-da89143c"),e=e(),jt(),e),Eo={class:"table-toolbar"},Vo={class:"flex items-center table-toolbar-left"},Io={key:0,class:"table-toolbar-left-title"},xo={class:"flex items-center table-toolbar-right"},Ao={class:"mr-2 table-toolbar-right-icon"},Bo=De(()=>T("span",null,"表格斑马纹",-1)),Ho=De(()=>T("span",null,"刷新",-1)),Uo={class:"table-toolbar-right-icon"},Mo=De(()=>T("span",null,"密度",-1)),qo={class:"s-table"};function Wo(e,t,n,o,a,u){const f=B("QuestionCircleOutlined"),r=pe,i=Oe,g=Ye,S=We,D=B("ReloadOutlined"),F=B("ColumnHeightOutlined"),c=Yt,m=nt,h=Qe;return x(),q(Kt,null,[T("div",Eo,[T("div",Vo,[e.title?(x(),q("div",Io,[ee(Se(e.title)+" ",1),e.titleTooltip?(x(),Ne(i,{key:0,trigger:"hover"},{trigger:k(()=>[_(r,{size:"18",class:"ml-1 text-gray-400 cursor-pointer"},{default:k(()=>[_(f)]),_:1})]),default:k(()=>[ee(" "+Se(e.titleTooltip),1)]),_:1})):me("",!0)])):me("",!0),be(e.$slots,"tableTitle",{},void 0,!0)]),T("div",xo,[be(e.$slots,"toolbar",{},void 0,!0),_(i,{trigger:"hover"},{trigger:k(()=>[T("div",Ao,[_(g,{value:e.isStriped,"onUpdate:value":[t[0]||(t[0]=d=>e.isStriped=d),e.setStriped]},null,8,["value","onUpdate:value"])])]),default:k(()=>[Bo]),_:1}),_(S,{vertical:""}),_(i,{trigger:"hover"},{trigger:k(()=>[T("div",{class:"table-toolbar-right-icon",onClick:t[1]||(t[1]=(...d)=>e.reload&&e.reload(...d))},[_(r,{size:"18"},{default:k(()=>[_(D)]),_:1})])]),default:k(()=>[Ho]),_:1}),_(i,{trigger:"hover"},{trigger:k(()=>[T("div",Uo,[_(c,{onSelect:e.densitySelect,trigger:"click",options:e.densityOptions,value:e.tableSize,"onUpdate:value":t[2]||(t[2]=d=>e.tableSize=d)},{default:k(()=>[_(r,{size:"18"},{default:k(()=>[_(F)]),_:1})]),_:1},8,["onSelect","options","value"])])]),default:k(()=>[Mo]),_:1}),_(m)])]),T("div",qo,[_(h,je({ref:"tableElRef"},e.getBindValues,{striped:e.isStriped,pagination:e.pagination,"onUpdate:page":e.updatePage,"onUpdate:pageSize":e.updatePageSize}),Ut({_:2},[Mt(Object.keys(e.$slots),d=>({name:d,fn:k(p=>[be(e.$slots,d,qt(Wt(p)),void 0,!0)])}))]),1040,["striped","pagination","onUpdate:page","onUpdate:pageSize"])])],64)}const ta=ye(Po,[["render",Wo],["__scopeId","data-v-da89143c"]]);export{ta as B};
